{% extends 'base.html' %}
{% block title %}Tenant Dashboard{% endblock %}
{% block content %}
<div class="flex flex-col items-center justify-center min-h-[70vh] py-10">
  {% if request.session.welcome_property %}
    <div class="w-full max-w-2xl mb-6">
      <div class="bg-primary/20 border-l-4 border-primary p-4 rounded shadow text-black text-lg font-semibold">
        Welcome to {{ request.session.welcome_property }}! Your profile is set up. Explore your dashboard below.
      </div>
    </div>
  {% endif %}
  <h2 class="text-3xl font-extrabold text-black mb-2 text-center">Tenant Dashboard</h2>
  <div class="w-full max-w-2xl mb-8">
    {% if lease %}
      <div class="bg-white rounded-lg shadow border border-gray-200 p-6 mb-6">
        <h3 class="text-xl font-bold text-black mb-2">Lease Details</h3>
        <p><strong>Property:</strong> {{ unit.property.name }}</p>
        <p><strong>Unit:</strong> {{ unit.unit_number }}</p>
        <p><strong>Start Date:</strong> {{ lease.start_date }}</p>
        <p><strong>End Date:</strong> {{ lease.end_date }}</p>
        <p><strong>Rent Amount:</strong> ${{ lease.rent_amount }}</p>
        <p><strong>Status:</strong> {% if lease.is_active %}Active{% else %}Inactive{% endif %}</p>
      </div>
      <div class="bg-white rounded-lg shadow border border-gray-200 p-6 mb-6">
        <h3 class="text-xl font-bold text-black mb-2">Rent Due</h3>
        <div class="flex items-center gap-4 mb-2">
          <span class="text-3xl font-extrabold text-primary">${{ rent_balance }}</span>
          <form method="post" class="flex flex-col md:flex-row gap-2 items-end">
            {% csrf_token %}
            <input type="hidden" name="pay_rent" value="1">
            <input type="number" step="0.01" min="1" max="{{ rent_balance }}" name="amount" id="amount" class="w-32 px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary bg-gray-50" required placeholder="Amount">
            <select name="payment_method" class="w-40 px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary bg-gray-50" required>
              <option value="" disabled selected>Select Payment Method</option>
              <option value="mpesa">M-Pesa</option>
              <option value="bank">Bank Transfer</option>
              <option value="card">Card Transaction</option>
            </select>
            <button type="submit" class="bg-primary text-black font-semibold px-4 py-2 rounded hover:bg-black hover:text-primary transition">Pay Rent</button>
          </form>
        </div>
        {% if payment_success %}
          <div class="mt-2 p-2 bg-green-100 text-green-700 rounded">Payment received! A receipt has been sent to your email.</div>
        {% endif %}
      </div>
      <div class="bg-white rounded-lg shadow border border-gray-200 p-6 mb-6">
        <h3 class="text-xl font-bold text-black mb-2">Payment History</h3>
        {% if payments %}
          <ul class="list-disc pl-5 text-gray-700 space-y-1">
            {% for payment in payments %}
              <li>
                ${{ payment.amount }} - {{ payment.payment_date }} - {{ payment.get_payment_method_display }} {% if payment.is_confirmed %}(Confirmed){% else %}(Pending){% endif %}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-gray-700">No payments yet.</p>
        {% endif %}
      </div>
      <div class="bg-white rounded-lg shadow border border-gray-200 p-6 mb-6">
        <h3 class="text-xl font-bold text-black mb-2">Maintenance Requests</h3>
        <a href="{% url 'maintenance:chat' %}" class="bg-primary text-black font-semibold px-4 py-2 rounded hover:bg-black hover:text-primary transition mb-2 inline-block">Submit Maintenance Request</a>
        {% if maintenance_requests %}
          <ul class="list-disc pl-5 text-gray-700 space-y-1">
            {% for req in maintenance_requests %}
              <li>
                {{ req.description }} - {{ req.status|title }} ({{ req.created_at }})
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-gray-700">No maintenance requests yet.</p>
        {% endif %}
      </div>
    {% else %}
      <div class="bg-yellow-100 border-l-4 border-yellow-400 p-4 rounded shadow text-black text-lg font-semibold">
        No active lease found. Please contact your property owner for more information.
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% extends 'base.html' %}
{% block title %}Tenant Profile{% endblock %}
{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">Tenant Profile</h2>
    {% if lease %}
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Lease Agreement</h5>
                <p><strong>Property:</strong> {{ unit.property.name }}</p>
                <p><strong>Unit:</strong> {{ unit.unit_number }}</p>
                <p><strong>Start Date:</strong> {{ lease.start_date }}</p>
                <p><strong>End Date:</strong> {{ lease.end_date }}</p>
                <p><strong>Rent Amount:</strong> ${{ lease.rent_amount }}</p>
                <p><strong>Status:</strong> {% if lease.is_active %}Active{% else %}Inactive{% endif %}</p>
            </div>
        </div>
        <div class="mb-4">
            <h5>Rent Balance: ${{ rent_balance }}</h5>
            {% if payment_success %}
                <div class="alert alert-success">Payment received! A receipt has been sent to your email.</div>
            {% endif %}
            <form method="post" class="row g-2 align-items-end">
                {% csrf_token %}
                <input type="hidden" name="pay_rent" value="1">
                <div class="col-auto">
                    <label for="amount" class="form-label">Amount</label>
                    <input type="number" step="0.01" min="1" max="{{ rent_balance }}" name="amount" id="amount" class="form-control" required>
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-success">Pay Rent</button>
                </div>
            </form>
        </div>
        <div class="mb-4">
            <h5>Payment History</h5>
            {% if payments %}
                <ul class="list-group">
                    {% for payment in payments %}
                        <li class="list-group-item">
                            ${{ payment.amount }} - {{ payment.payment_date }} {% if payment.is_confirmed %}(Confirmed){% else %}(Pending){% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No payments yet.</p>
            {% endif %}
        </div>
        <div class="mb-4">
            <h5>Maintenance Requests</h5>
            <a href="{% url 'maintenance:chat' %}" class="btn btn-outline-primary mb-2">Request Maintenance</a>
            {% if maintenance_requests %}
                <ul class="list-group">
                    {% for req in maintenance_requests %}
                        <li class="list-group-item">
                            {{ req.description }} - {{ req.status|title }} ({{ req.created_at }})
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No maintenance requests yet.</p>
            {% endif %}
        </div>
    {% else %}
        <p>No active lease found.</p>
    {% endif %}
</div>
{% endblock %}
